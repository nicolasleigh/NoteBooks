[github repo](https://github.com/stacksimplify/docker-in-a-weekend/tree/main)

# 02: How to Pull and Run Docker Images from Docker Hub and Run

## Step 1: Pull Docker Image from Docker Hub

```sh
# List Docker images (should be empty if none are pulled yet)
docker images

# Pull Docker image from Docker Hub
docker pull stacksimplify/mynginx:v1

# Alternatively, pull from GitHub Packages (no download limits)
docker pull ghcr.io/stacksimplify/mynginx:v1

# List Docker images to confirm the image is pulled
docker images
```

## Step 2: Run the Downloaded Docker Image

```sh
# Run Docker Container
docker run --name <CONTAINER-NAME> -p <HOST_PORT>:<CONTAINER_PORT> -d <IMAGE_NAME>:<TAG>

docker run --name myapp1 -p 8080:80 -d stacksimplify/mynginx:v1
```

## Step 3: List Running Docker Containers

```sh
# List only running containers
docker ps

# List all containers (including stopped ones)
docker ps -a

# List only container IDs
docker ps -q
```

## Step 4: Connect to Docker Container Terminal

```sh
# Connect to the container's terminal
docker exec -it <CONTAINER-NAME> /bin/sh

# Example:
docker exec -it myapp1 /bin/sh

# Inside the container, you can run commands:
ls
hostname
exit  # To exit the container's terminal
```

**Execute Commands Directly:**

```sh
# List directory contents inside the container
docker exec -it myapp1 ls

# Get the hostname of the container
docker exec -it myapp1 hostname

# Print environment variables
docker exec -it myapp1 printenv

# Check disk space usage
docker exec -it myapp1 df -h
```

## Step 5: Stop and Start Docker Containers

```sh
# Stop a running container
docker stop <CONTAINER-NAME>

# Example:
docker stop myapp1

# Verify the container has stopped
docker ps

# Test if the application is down
curl http://localhost:8080

# Start the stopped container
docker start <CONTAINER-NAME>

# Example:
docker start myapp1

# Verify the container is running
docker ps

# Test if the application is back up
curl http://localhost:8080
```

## Step 6: Remove Docker Containers

```sh
# Stop the container if it's still running
docker stop <CONTAINER-NAME>
docker stop myapp1

# Remove the container
docker rm <CONTAINER-NAME>
docker rm myapp1

# Or stop and remove the container in one command
docker rm -f <CONTAINER-NAME>
docker rm -f myapp1
```

## Step 7: Remove Docker Images

```sh
# List Docker images
docker images

# Remove Docker image using Image ID
docker rmi <IMAGE-ID>

# Example:
docker rmi abc12345def6

# Remove Docker image using Image Name and Tag
docker rmi <IMAGE-NAME>:<IMAGE-TAG>

# Example:
docker rmi stacksimplify/mynginx:v1
```

# 03: How to Create and Push Docker Images to Docker Hub

## Step 1: Verify Docker Version and Log In via Command Line

```sh
# Check Docker version
docker version

# Log in to Docker Hub
docker login

# To Logout from Docker Hub
docker logout
```

## Step 2: Run the Base Nginx Container

```sh
# Run the default Nginx Docker Image
docker run --name <CONTAINER-NAME> -p <HOST_PORT>:<CONTAINER_PORT> -d <IMAGE_NAME>:<TAG>

# Example:
docker run --name myapp1 -p 8090:80 -d nginx

# List running Docker containers
docker ps

# Access the application in your browser
http://localhost:8090

# Stop and remove the Docker container
docker stop myapp1
docker rm myapp1

# Or force remove the container
docker rm -f myapp1
```

## Step 3: Create Dockerfile and Customized `index.html`

Inside `Dockerfiles` directory, create a `Dockerfile`:

```dockerfile
FROM nginx
COPY index.html /usr/share/nginx/html
```

Create **`index.html`:**

```html
<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>StackSimplify</title>
  <style>
    body { 
      font-family: Arial, sans-serif; 
      text-align: center; 
      padding: 50px; 
      background-color: rgb(197, 144, 144);
    }
    h1 { font-size: 50px; }
    h2 { font-size: 40px; }
    h3 { font-size: 30px; }
    p { font-size: 20px; }
  </style>
</head>
<body>
  <h1>Welcome to StackSimplify</h1>
  <h2>Docker Image BUILD, RUN, TAG and PUSH to Docker Hub</h2>
  <p>Learn technology through practical, real-world demos.</p>
  <p>Application Version: v1</p>
</body>
</html>
```

## Step 4: Build Docker Image and Run It

```sh
# Change to the directory containing your Dockerfile
cd Dockerfiles

# Build the Docker image
docker build -t <IMAGE_NAME>:<TAG> .

# Example:
docker build -t mynginx-custom:v1 .

# List Docker images
docker images

# Run the Docker container and verify
docker run --name <CONTAINER-NAME> -p <HOST_PORT>:<CONTAINER_PORT> -d <IMAGE_NAME>:<TAG>

# Example:
docker run --name mynginx1 -p 8090:80 -d mynginx-custom:v1

# Access the application in your browser
http://localhost:8090
```

## Step 5: Tag and Push the Docker Image to Docker Hub

```sh
# List Docker images
docker images

# Tag the Docker image
docker tag mynginx-custom:v1 YOUR_DOCKER_USERNAME/mynginx-custom:v1

# Example with 'stacksimplify':
docker tag mynginx-custom:v1 stacksimplify/mynginx-custom:v1

# Push the Docker image to Docker Hub
docker push YOUR_DOCKER_USERNAME/mynginx-custom:v1

# Example with 'stacksimplify':
docker push stacksimplify/mynginx-custom:v1

# IMPORTANT NOTE:
# Replace YOUR_DOCKER_USERNAME with your actual Docker Hub username.
```

## Step 6: Use Docker Search Command

```sh
# Search for 'nginx' images
docker search nginx

# Limit the search results to 5
docker search nginx --limit 5

# Filter search results by stars (e.g., images with at least 50 stars)
docker search --filter=stars=50 nginx

# Filter for official images only
docker search --filter=is-official=true nginx
```

# 04: Create Docker Image with Labels and Push to Docker Hub

## Step 1: Create Dockerfile and Customized `index.html`

```dockerfile
# Use nginx:alpine-slim as base Docker Image
FROM nginx:alpine-slim

# Custom Labels
LABEL maintainer="Kalyan Reddy Daida"  
LABEL version="1.0"
LABEL description="A simple Nginx Application"
# OCI Labels
LABEL org.opencontainers.image.authors="Kalyan Reddy Daida"
LABEL org.opencontainers.image.title="Nginx Alpine Slim Application"
LABEL org.opencontainers.image.description="A lightweight Nginx application built on Alpine."
LABEL org.opencontainers.image.version="1.0"
LABEL org.opencontainers.image.revision="1234567890abcdef" 
LABEL org.opencontainers.image.created="2024-10-14T08:30:00Z"
LABEL org.opencontainers.image.url="https://github.com/stacksimplify/docker-in-a-weekend"
LABEL org.opencontainers.image.source="https://github.com/stacksimplify/docker-in-a-weekend/tree/main/04-Dockerfile-LABELS/Dockerfiles"
LABEL org.opencontainers.image.documentation="https://github.com/stacksimplify/docker-in-a-weekend/tree/main/04-Dockerfile-LABELS"
LABEL org.opencontainers.image.vendor="STACKSIMPLIFY"
LABEL org.opencontainers.image.licenses="Apache-2.0"

# Using COPY to copy a local file
COPY index.html /usr/share/nginx/html
```

```html
<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>StackSimplify</title>
  <style>
    body { 
      font-family: Arial, sans-serif; 
      text-align: center; 
      padding: 50px; 
      background-color: rgb(227, 213, 180);
    }
    h1 { font-size: 50px; }
    h2 { font-size: 40px; }
    h3 { font-size: 30px; }
    p { font-size: 20px; }
  </style>
</head>
<body>
  <h1>Welcome to StackSimplify</h1>
  <h2>Dockerfile: Nginx Alpine Slim Docker Image with custom LABELS and OCI LABELS</h2>
  <p>Learn technology through practical, real-world demos.</p>
  <p>Application Version: v1</p>
</body>
</html>
```

## Step 2: Build Docker Image and Run It

```sh
# Change to the directory containing your Dockerfile
cd Dockerfiles

# Build the Docker image
docker build -t [IMAGE-NAME]:[IMAGE-TAG] .

# Example:
docker build -t demo4-dockerfile-labels:v1 .

# Important Notes:
# 1. [IMAGE-TAG] is optional; if not provided, it defaults to "latest".
# 2. Best practice is to use explicit tags.

# List Docker Images
docker images

# Run the Docker container
docker run --name mylabels-demo -p 8080:80 -d demo4-dockerfile-labels:v1

# Access the application in your browser
http://localhost:8080
```

## Step 3: Install `jq` Package

`jq` is a lightweight and flexible command-line JSON processor, useful for parsing JSON output from commands like `docker inspect`.

**For macOS:**

```sh
brew install jq
jq --version
```

**For Linux (Ubuntu/Debian):**

```sh
sudo apt-get update
sudo apt-get install jq
jq --version
```

## Step 4: Docker Image Inspect Commands

```sh
# Inspect the Docker image
docker image inspect [IMAGE-NAME]:[IMAGE-TAG]

# Example:
docker image inspect demo4-dockerfile-labels:v1

# Get the creation date of the Docker image
docker inspect --format='{{.Created}}' [IMAGE-NAME]:[IMAGE-TAG]

# Example:
docker inspect --format='{{.Created}}' demo4-dockerfile-labels:v1

# Get the Docker image labels (unformatted)
docker inspect --format='{{json .Config.Labels}}' [IMAGE-NAME]:[IMAGE-TAG]

# Example:
docker image inspect --format='{{json .Config.Labels}}' demo4-dockerfile-labels:v1

# Get the Docker image labels (formatted with jq)
docker image inspect --format='{{json .Config.Labels}}' [IMAGE-NAME]:[IMAGE-TAG] | jq

# Example:
docker image inspect --format='{{json .Config.Labels}}' demo4-dockerfile-labels:v1 | jq
```

## Step 5: Docker Container Inspect Commands

```sh
# Inspect the Docker container
docker inspect [CONTAINER-NAME or CONTAINER-ID]

# Example:
docker inspect mylabels-demo

# Get the IP address of the container
docker inspect --format='{{.NetworkSettings.IPAddress}}' [CONTAINER-NAME or CONTAINER-ID]

# Example:
docker inspect --format='{{.NetworkSettings.IPAddress}}' mylabels-demo

# Inspect container state (running, paused, stopped)
docker inspect --format='{{.State.Status}}' [CONTAINER-NAME or CONTAINER-ID]

# Example:
docker inspect --format='{{.State.Status}}' mylabels-demo

# Inspect exposed ports
docker inspect --format='{{json .Config.ExposedPorts}}' [CONTAINER-NAME or CONTAINER-ID]

# Example:
docker inspect --format='{{json .Config.ExposedPorts}}' mylabels-demo

# Inspect network details of the container (formatted with jq)
docker inspect --format='{{json .NetworkSettings}}' [CONTAINER-NAME or CONTAINER-ID] | jq

# Example:
docker inspect --format='{{json .NetworkSettings}}' mylabels-demo | jq
```

## Step 6: Stop and Remove Container and Images

```sh
# Stop and remove the container
docker rm -f mylabels-demo

# Remove the Docker images
docker rmi demo4-dockerfile-labels:v1

# List Docker Images to confirm removal
docker images
```

# 05: Learn Dockerfile ADD vs COPY Instructions Practically

## Step 1: Review App-Files Folder and Tar the Files

```sh
# Navigate to the App-Files directory
cd App-Files

# Create a tar.gz archive of the files
tar -czvf static_files.tar.gz index.html file1.html file2.html file3.html file4.html file5.html

# Copy the tar.gz file to the Dockerfiles directory
cp static_files.tar.gz ../Dockerfiles

# Review the copy-file.html in Dockerfiles
cat ../Dockerfiles/copy-file.html
```

## Step 2: Create Dockerfile and Copy Customized Files

```dockerfile
# Use nginx:alpine-slim as base Docker Image
FROM nginx:alpine-slim

# OCI Labels
LABEL org.opencontainers.image.authors="Kalyan Reddy Daida"
LABEL org.opencontainers.image.title="Demo: COPY vs ADD Instructions in Dockerfile"
LABEL org.opencontainers.image.description="A Dockerfile demo illustrating the differences between COPY and ADD instructions, including copying files and extracting tarballs."
LABEL org.opencontainers.image.version="1.0"

# Using COPY to copy a local file
COPY copy-file.html /usr/share/nginx/html

# Using ADD to copy a file and extract a tarball
ADD static_files.tar.gz /usr/share/nginx/html
```

## Step 3: Build Docker Image and Run It

```sh
# Change Directory
cd Dockerfiles

# Build Docker Image
docker build -t [IMAGE-NAME]:[IMAGE-TAG] .

# Example:
docker build -t demo5-dockerfile-add-vs-copy:v1 .

# Run Docker Container and Verify
docker run --name my-add-vs-copy-demo -p 8080:80 -d demo5-dockerfile-add-vs-copy:v1

# List Static Files from Docker Container
docker exec -it my-add-vs-copy-demo ls -lrta /usr/share/nginx/html


# Access Application
http://localhost:8080
```

## Step 4: Stop and Remove Container and Images

```sh
# Stop and remove the container
docker rm -f my-add-vs-copy-demo

# Remove the Docker images
docker rmi stacksimplify/demo5-dockerfile-add-vs-copy:v1
docker rmi demo5-dockerfile-add-vs-copy:v1

# List Docker Images to confirm removal
docker images
```

### COPY vs ADD in Dockerfile

### Key Points:



1. **COPY**:
   * Copies files and directories from the build context to the Image.
   * Simple and explicit in its functionality, used purely for file transfers.
   * Preferred for local files and directories as it is faster and avoids unintended side effects.
2. **ADD**:
   * Does everything `COPY` does, but with additional features.
   * Automatically extracts tar archives (e.g., `.tar`, `.tar.gz`).
   * Supports URLs, allowing files to be fetched from the web.
   * More versatile, but can introduce security risks (especially with URLs) and unintended behavior (e.g., auto-extraction).

### Best Practice:

#### Key Points:

1. **COPY**:
   * Copies files and directories from the build context to the Image.
   * Simple and explicit in its functionality, used purely for file transfers.
   * Preferred for local files and directories as it is faster and avoids unintended side effects.
2. **ADD**:
   * Does everything `COPY` does, but with additional features.
   * Automatically extracts tar archives (e.g., `.tar`, `.tar.gz`).
   * Supports URLs, allowing files to be fetched from the web.
   * More versatile, but can introduce security risks (especially with URLs) and unintended behavior (e.g., auto-extraction).

#### Best Practice:

* Use `COPY` whenever possible for local files. Reserve `ADD` for cases where you need to extract a tarball or download from a URL.

# 06: Learn Dockerfile ADD with Fetch from URL Practically

## Step 1: Create Dockerfile and Add Instructions

```dockerfile
# Use nginx:alpine-slim as base Docker Image
FROM nginx:alpine-slim

# OCI Labels
LABEL org.opencontainers.image.authors="Kalyan Reddy Daida"
LABEL org.opencontainers.image.title="Demo: Using ADD Instruction to Fetch Files from a URL in Dockerfile"
LABEL org.opencontainers.image.description="A Dockerfile demo illustrating the ADD instruction, which demonstrates how to download and add content from a GitHub Releases URL to the container."
LABEL org.opencontainers.image.version="1.0"

# Using GitHub Repository to download files
ADD https://github.com/stacksimplify/docker-add-fetch-url-demo.git#v1.0.0:docs /usr/share/nginx/html
```

## Step 2: Build Docker Image and Run It

```sh
# Change Directory
cd Dockerfiles

# Build Docker Image
docker build -t [IMAGE-NAME]:[IMAGE-TAG] .

# Example:
docker build -t demo6-dockerfile-add-fetch-url:v1 .

# Run Docker Container and Verify
docker run --name my-add-fetch-url-demo -p 8080:80 -d demo6-dockerfile-add-fetch-url:v1

# List Static Files from Docker Container
docker exec -it my-add-fetch-url-demo ls -l /usr/share/nginx/html

# Access Application
http://localhost:8080
```

# 07: Learn Dockerfile ARG Instructions Practically

## Step 1: Create Dockerfile with ARG Instruction

```dockerfile
# Define a build-time argument for the NGINX version
ARG NGINX_VERSION=1.26

# Use nginx:alpine-slim as base Docker Image with specified NGINX_VERSION
FROM nginx:${NGINX_VERSION}-alpine-slim

# OCI Labels
LABEL org.opencontainers.image.authors="Kalyan Reddy Daida"
LABEL org.opencontainers.image.title="Demo: Using ARG Instruction"
LABEL org.opencontainers.image.description="A Dockerfile demo illustrating the ARG instruction"
LABEL org.opencontainers.image.version="1.0"

# Copy a custom index.html to the Nginx HTML directory
COPY index.html /usr/share/nginx/html
```

## Step 2: Build Docker Images and Run Them

```sh
# Change to the directory containing your Dockerfile
cd Dockerfiles

# Build Docker Image using the default NGINX_VERSION from the Dockerfile
docker build -t [IMAGE-NAME]:[IMAGE-TAG] .

# Example:
docker build -t demo7-dockerfile-arg:v1.26 .

# Run Docker Container and Verify
docker run --name my-arg-demo1 -p 8080:80 -d demo7-dockerfile-arg:v1.26

# Verify Nginx version inside the container
docker exec -it my-arg-demo1 nginx -v

# Access the application in your browser
http://localhost:8080
```

#### Build Docker Image by Overriding ARG Value

```sh
# Build Docker Image by specifying a different NGINX_VERSION at build time
docker build --build-arg NGINX_VERSION=1.27 -t [IMAGE-NAME]:[IMAGE-TAG] .

# Example:
docker build --build-arg NGINX_VERSION=1.27 -t demo7-dockerfile-arg:v1.27 .

# Run Docker Container and Verify
docker run --name my-arg-demo2 -p 8081:80 -d demo7-dockerfile-arg:v1.27

# Verify Nginx version inside the container
docker exec -it my-arg-demo2 nginx -v

# Access the application in your browser
http://localhost:8081
```

**ARG vs. ENV:**

* `ARG` variables are only available during the build time of the image.
* `ENV` variables are available during runtime within the container. 

# 08: Learn Dockerfile EXPOSE and RUN Instructions Practically

## Step 1: Application Files

#### Nginx Configuration Files

* **Directory:** `DockerFiles/nginx-conf`

**`nginx-8081.conf`:**

```nginx
server {
    listen 8081;
    server_name localhost;

    location / {
        root /usr/share/nginx/html;
        index index-8081.html;
    }
}
```

**`nginx-8082.conf`:**

```nginx
server {
    listen 8082;
    server_name localhost;

    location / {
        root /usr/share/nginx/html;
        index index-8082.html;
    }
}
```

**`nginx-8083.conf`:**

```nginx
server {
    listen 8083;
    server_name localhost;

    location / {
        root /usr/share/nginx/html;
        index index-8083.html;
    }
}
```

#### Nginx HTML Files

* **Directory:** `DockerFiles/nginx-html`

**`index-8081.html`:**

```html
<!DOCTYPE html> 
<html> 
  <body style='background-color:rgb(135, 215, 159);'> 
    <h1>Welcome to StackSimplify - RUN, EXPOSE Dockerfile Instructions</h1>
    <h2>Response from Nginx on port 8081</h2> 
    <p>Learn technology through practical, real-world demos.</p> 
    <p>Application Version: V1</p>      
    <p>EXPOSE: Describe which ports your application is listening on.</p>     
    <p>RUN: Execute build commands.</p>     
  </body>
</html>
```

**`index-8082.html`:**

```html
<!DOCTYPE html> 
<html> 
  <body style='background-color:rgb(210, 153, 152);'> 
    <h1>Welcome to StackSimplify - RUN, EXPOSE Dockerfile Instructions</h1>
    <h2>Response from Nginx on port 8082</h2> 
    <p>Learn technology through practical, real-world demos.</p> 
    <p>Application Version: V1</p>      
    <p>EXPOSE: Describe which ports your application is listening on.</p>     
    <p>RUN: Execute build commands.</p>     
  </body>
</html>
```

**`index-8083.html`:**

```html
<!DOCTYPE html> 
<html> 
  <body style='background-color:rgb(227, 213, 180);'> 
    <h1>Welcome to StackSimplify - RUN, EXPOSE Dockerfile Instructions</h1>
    <h2>Response from Nginx on port 8083</h2> 
    <p>Learn technology through practical, real-world demos.</p> 
    <p>Application Version: V1</p>      
    <p>EXPOSE: Describe which ports your application is listening on.</p>     
    <p>RUN: Execute build commands.</p>     
  </body>
</html>
```

**`index.html`:**

```html
<!DOCTYPE html> 
<html> 
  <body style='background-color:rgb(157, 182, 216);'> 
    <h1>Welcome to StackSimplify - RUN, EXPOSE Dockerfile Instructions</h1>
    <h2>Response from Nginx on port 80</h2> 
    <p>Learn technology through practical, real-world demos.</p> 
    <p>Application Version: V1</p>      
    <p>EXPOSE: Describe which ports your application is listening on.</p>     
    <p>RUN: Execute build commands.</p>     
  </body>
</html>
```

## Step 2: Create Dockerfile

* **Directory:** `DockerFiles`

Create a `Dockerfile` with the following content:

```dockerfile
# Use nginx:alpine-slim as base Docker Image
FROM nginx:alpine-slim

# OCI Labels
LABEL org.opencontainers.image.authors="Kalyan Reddy Daida"
LABEL org.opencontainers.image.title="Demo: Using RUN and EXPOSE Instructions in Dockerfile"
LABEL org.opencontainers.image.description="A Dockerfile demo illustrating the usage of RUN and EXPOSE instructions"
LABEL org.opencontainers.image.version="1.0"

# Copy all Nginx configuration files from nginx-conf directory
COPY nginx-conf/*.conf /etc/nginx/conf.d/

# Copy all HTML files from nginx-html directory
COPY nginx-html/*.html /usr/share/nginx/html/

# Install curl using RUN
RUN apk --no-cache add curl

# Expose the ports 8081, 8082, 8083 (default port 80 already exposed from base nginx image)
EXPOSE 8081 8082 8083
```

## Step 3: Build Docker Image and Run It

```sh
# Change Directory
cd DockerFiles

# Build Docker Image 
docker build -t [IMAGE-NAME]:[IMAGE-TAG] .

# Example:
docker build -t demo8-dockerfile-expose-run:v1 .

# Inspect Labels
docker image inspect demo8-dockerfile-expose-run:v1

# Run Docker Container and Map Ports
docker run --name my-expose-run-demo -p 8080:80 -p 8081:8081 -p 8082:8082 -p 8083:8083 -d demo8-dockerfile-expose-run:v1

# Access Application in Browser
http://localhost:8080
http://localhost:8081
http://localhost:8082
http://localhost:8083

# List Configuration Files from Docker Container
docker exec -it my-expose-run-demo ls /etc/nginx/conf.d

# List HTML Files from Docker Container
docker exec -it my-expose-run-demo ls /usr/share/nginx/html

# Connect to Container Shell
docker exec -it my-expose-run-demo /bin/sh

# Commands to Run inside the Container
curl http://localhost
curl http://localhost:8081
curl http://localhost:8082
curl http://localhost:8083

# Exit the Container Shell
exit
```

**EXPOSE Instruction:**

* The `EXPOSE` instruction informs Docker that the container listens on the specified network ports at runtime.
* It does not actually publish the ports; you still need to use the `-p` or `-P` flag with `docker run` to map the ports.

**RUN Instruction:**

* The `RUN` instruction executes commands in a new layer on top of the current image and commits the results.
* It's used for installing software packages or any command that needs to be run during the image build process.

# 09: Learn Dockerfile ARG vs ENV, CMD, RUN, WORKDIR Instructions Practically

https://github.com/stacksimplify/docker-in-a-weekend/blob/main/09-Dockerfile-ARG-ENV-CMD-WORKDIR/README.md